// don't copy my code motherfuckers 
// script encrypted by TKT-TECH
cmVxdWlyZSgnLi9zZXR0aW5ncycpCmNvbnN0IHsgQm9vbSB9ID0gcmVxdWlyZSgnQGhhcGkvYm9vbScpCmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKQpjb25zdCBjaGFsayA9IHJlcXVpcmUoJ2NoYWxrJykKY29uc3QgRmlsZVR5cGUgPSByZXF1aXJlKCdmaWxlLXR5cGUnKQpjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpCmNvbnN0IGF4aW9zID0gcmVxdWlyZSgnYXhpb3MnKQpjb25zdCB7IGhhbmRsZU1lc3NhZ2VzLCBoYW5kbGVHcm91cFBhcnRpY2lwYW50VXBkYXRlLCBoYW5kbGVTdGF0dXMgfSA9IHJlcXVpcmUoJy4vbWFpbicpOwpjb25zdCBQaG9uZU51bWJlciA9IHJlcXVpcmUoJ2F3ZXNvbWUtcGhvbmVudW1iZXInKQpjb25zdCB7IGltYWdlVG9XZWJwLCB2aWRlb1RvV2VicCwgd3JpdGVFeGlmSW1nLCB3cml0ZUV4aWZWaWQgfSA9IHJlcXVpcmUoJy4vbGliL2V4aWYnKQpjb25zdCB7IHNtc2csIGlzVXJsLCBnZW5lcmF0ZU1lc3NhZ2VUYWcsIGdldEJ1ZmZlciwgZ2V0U2l6ZU1lZGlhLCBmZXRjaCwgYXdhaXQsIHNsZWVwLCByZVNpemUgfSA9IHJlcXVpcmUoJy4vbGliL215ZnVuYycpCmNvbnN0IHsKICAgIGRlZmF1bHQ6IG1ha2VXQVNvY2tldCwKICAgIHVzZU11bHRpRmlsZUF1dGhTdGF0ZSwKICAgIERpc2Nvbm5lY3RSZWFzb24sCiAgICBmZXRjaExhdGVzdEJhaWxleXNWZXJzaW9uLAogICAgZ2VuZXJhdGVGb3J3YXJkTWVzc2FnZUNvbnRlbnQsCiAgICBwcmVwYXJlV0FNZXNzYWdlTWVkaWEsCiAgICBnZW5lcmF0ZVdBTWVzc2FnZUZyb21Db250ZW50LAogICAgZ2VuZXJhdGVNZXNzYWdlSUQsCiAgICBkb3dubG9hZENvbnRlbnRGcm9tTWVzc2FnZSwKICAgIGppZERlY29kZSwKICAgIHByb3RvLAogICAgamlkTm9ybWFsaXplZFVzZXIsCiAgICBtYWtlQ2FjaGVhYmxlU2lnbmFsS2V5U3RvcmUsCiAgICBkZWxheQp9ID0gcmVxdWlyZSgiQHdoaXNrZXlzb2NrZXRzL2JhaWxleXMiKQpjb25zdCBOb2RlQ2FjaGUgPSByZXF1aXJlKCJub2RlLWNhY2hlIikKLy8gVXNpbmcgYSBsaWdodHdlaWdodCBwZXJzaXN0ZWQgc3RvcmUgaW5zdGVhZCBvZiBtYWtlSW5NZW1vcnlTdG9yZSAoY29tcGF0IGFjcm9zcyB2ZXJzaW9ucykKY29uc3QgcGlubyA9IHJlcXVpcmUoInBpbm8iKQpjb25zdCByZWFkbGluZSA9IHJlcXVpcmUoInJlYWRsaW5lIikKY29uc3QgeyBwYXJzZVBob25lTnVtYmVyIH0gPSByZXF1aXJlKCJsaWJwaG9uZW51bWJlci1qcyIpCmNvbnN0IHsgUEhPTkVOVU1CRVJfTUNDIH0gPSByZXF1aXJlKCdAd2hpc2tleXNvY2tldHMvYmFpbGV5cy9saWIvVXRpbHMvZ2VuZXJpY3MnKQpjb25zdCB7IHJtU3luYywgZXhpc3RzU3luYyB9ID0gcmVxdWlyZSgnZnMnKQpjb25zdCB7IGpvaW4gfSA9IHJlcXVpcmUoJ3BhdGgnKQoKLy8gSW1wb3J0IGxpZ2h0d2VpZ2h0IHN0b3JlCmNvbnN0IHN0b3JlID0gcmVxdWlyZSgnLi9saWIvbGlnaHR3ZWlnaHRfc3RvcmUnKQoKLy8gSW5pdGlhbGl6ZSBzdG9yZQpzdG9yZS5yZWFkRnJvbUZpbGUoKQpjb25zdCBzZXR0aW5ncyA9IHJlcXVpcmUoJy4vc2V0dGluZ3MnKQpzZXRJbnRlcnZhbCgoKSA9PiBzdG9yZS53cml0ZVRvRmlsZSgpLCBzZXR0aW5ncy5zdG9yZVdyaXRlSW50ZXJ2YWwgfHwgMTAwMDApCgovLyBNZW1vcnkgb3B0aW1pemF0aW9uIC0gRm9yY2UgZ2FyYmFnZSBjb2xsZWN0aW9uIGlmIGF2YWlsYWJsZQpzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICBpZiAoZ2xvYmFsLmdjKSB7CiAgICAgICAgZ2xvYmFsLmdjKCkKICAgICAgICBjb25zb2xlLmxvZygn8J+nuSBHYXJiYWdlIGNvbGxlY3Rpb24gY29tcGxldGVkJykKICAgIH0KfSwgNjBfMDAwKSAvLyBldmVyeSAxIG1pbnV0ZQoKLy8gTWVtb3J5IG1vbml0b3JpbmcgLSBSZXN0YXJ0IGlmIFJBTSBnZXRzIHRvbyBoaWdoCnNldEludGVydmFsKCgpID0+IHsKICAgIGNvbnN0IHVzZWQgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCkucnNzIC8gMTAyNCAvIDEwMjQKICAgIGlmICh1c2VkID4gNDAwKSB7CiAgICAgICAgY29uc29sZS5sb2coJ+KaoO+4jyBSQU0gdG9vIGhpZ2ggKD40MDBNQiksIHJlc3RhcnRpbmcgYm90Li4uJykKICAgICAgICBwcm9jZXNzLmV4aXQoMSkgLy8gUGFuZWwgd2lsbCBhdXRvLXJlc3RhcnQKICAgIH0KfSwgMzBfMDAwKSAvLyBjaGVjayBldmVyeSAzMCBzZWNvbmRzCgpsZXQgcGhvbmVOdW1iZXIgPSAiMjYzNzgxNDAwNDczIgpsZXQgb3duZXIgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYygnLi9kYXRhL293bmVyLmpzb24nKSkKCmdsb2JhbC5ib3RuYW1lID0gIlRLVC1DWUJFUi1YTUQiCmdsb2JhbC50aGVtZWVtb2ppID0gIuKAoiIKY29uc3QgcGFpcmluZ0NvZGUgPSAhIXBob25lTnVtYmVyIHx8IHByb2Nlc3MuYXJndi5pbmNsdWRlcygiLS1wYWlyaW5nLWNvZGUiKQpjb25zdCB1c2VNb2JpbGUgPSBwcm9jZXNzLmFyZ3YuaW5jbHVkZXMoIi0tbW9iaWxlIikKCi8vIE9ubHkgY3JlYXRlIHJlYWRsaW5lIGludGVyZmFjZSBpZiB3ZSdyZSBpbiBhbiBpbnRlcmFjdGl2ZSBlbnZpcm9ubWVudApjb25zdCBybCA9IHByb2Nlc3Muc3RkaW4uaXNUVFkgPyByZWFkbGluZS5jcmVhdGVJbnRlcmZhY2UoeyBpbnB1dDogcHJvY2Vzcy5zdGRpbiwgb3V0cHV0OiBwcm9jZXNzLnN0ZG91dCB9KSA6IG51bGwKY29uc3QgcXVlc3Rpb24gPSAodGV4dCkgPT4gewogICAgaWYgKHJsKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBybC5xdWVzdGlvbih0ZXh0LCByZXNvbHZlKSkKICAgIH0gZWxzZSB7CiAgICAgICAgLy8gSW4gbm9uLWludGVyYWN0aXZlIGVudmlyb25tZW50LCB1c2Ugb3duZXJOdW1iZXIgZnJvbSBzZXR0aW5ncwogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoc2V0dGluZ3Mub3duZXJOdW1iZXIgfHwgcGhvbmVOdW1iZXIpCiAgICB9Cn0KCi8vIEF1dG8tam9pbiBmdW5jdGlvbiAtIE1PRElGSUVECmFzeW5jIGZ1bmN0aW9uIGF1dG9Kb2luQ29tbXVuaXR5KHNvY2spIHsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgYXV0b2pvaW5QYXRoID0gJy4vZGF0YS9hdXRvam9pbi5qc29uJzsKCiAgICAgICAgLy8gQ3JlYXRlIGNvbmZpZyBpZiBub3QgZXhpc3RzCiAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKGF1dG9qb2luUGF0aCkpIHsKICAgICAgICAgICAgY29uc3QgZGVmYXVsdENvbmZpZyA9IHsKICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsCiAgICAgICAgICAgICAgICBjaGFubmVsOiAiMTIwMzYzNDE4MDI3NjUxNzM4QG5ld3NsZXR0ZXIiLAogICAgICAgICAgICAgICAgd2VsY29tZU1lc3NhZ2U6ICJXZWxjb21lIHRvKiDinKogVEtULUNZQkVSLVhNRCpcblxuTmVlZCBhbnkgaGVscCBkbSBcbjI2MzcxODA5NTU1NSIKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZnMud3JpdGVGaWxlU3luYyhhdXRvam9pblBhdGgsIEpTT04uc3RyaW5naWZ5KGRlZmF1bHRDb25maWcsIG51bGwsIDIpKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGNvbmZpZyA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKGF1dG9qb2luUGF0aCwgJ3V0ZjgnKSk7CiAgICAgICAgaWYgKCFjb25maWcuZW5hYmxlZCkgcmV0dXJuOwoKICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5jeWFuKCfwn6SWIEF1dG8tam9pbiBmZWF0dXJlIGVuYWJsZWQuLi4nKSk7CgogICAgICAgIC8vIFNlbmQgd2VsY29tZSBtZXNzYWdlIHRvIGJvdCBudW1iZXIKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBib3ROdW1iZXIgPSBzb2NrLnVzZXIuaWQuc3BsaXQoJzonKVswXSArICdAcy53aGF0c2FwcC5uZXQnOwogICAgICAgICAgICBhd2FpdCBzb2NrLnNlbmRNZXNzYWdlKGJvdE51bWJlciwgewogICAgICAgICAgICAgICAgdGV4dDogY29uZmlnLndlbGNvbWVNZXNzYWdlIHx8ICJXZWxjb21lIHRvKiDinKogVEtULUNZQkVSLVhNRCpcblxuTmVlZCBhbnkgaGVscCBkbSBcbisyNjM3MTgwOTU1NTUiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5ncmVlbign4pyFIEF1dG8tam9pbiB3ZWxjb21lIG1lc3NhZ2Ugc2VudCcpKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay55ZWxsb3coJ+KaoCBDb3VsZCBub3Qgc2VuZCB3ZWxjb21lIG1lc3NhZ2UnKSk7CiAgICAgICAgfQoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignQXV0by1qb2luIGVycm9yOicsIGVycm9yKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gc3RhcnRYZW9uQm90SW5jKCkgewogICAgdHJ5IHsKICAgICAgICBsZXQgeyB2ZXJzaW9uLCBpc0xhdGVzdCB9ID0gYXdhaXQgZmV0Y2hMYXRlc3RCYWlsZXlzVmVyc2lvbigpCiAgICAgICAgY29uc3QgeyBzdGF0ZSwgc2F2ZUNyZWRzIH0gPSBhd2FpdCB1c2VNdWx0aUZpbGVBdXRoU3RhdGUoYC4vc2Vzc2lvbmApCiAgICAgICAgY29uc3QgbXNnUmV0cnlDb3VudGVyQ2FjaGUgPSBuZXcgTm9kZUNhY2hlKCkKCiAgICAgICAgY29uc3QgWGVvbkJvdEluYyA9IG1ha2VXQVNvY2tldCh7CiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIGxvZ2dlcjogcGlubyh7IGxldmVsOiAnc2lsZW50JyB9KSwKICAgICAgICAgICAgcHJpbnRRUkluVGVybWluYWw6ICFwYWlyaW5nQ29kZSwKICAgICAgICAgICAgYnJvd3NlcjogWyJVYnVudHUiLCAiQ2hyb21lIiwgIjIwLjAuMDQiXSwKICAgICAgICAgICAgYXV0aDogewogICAgICAgICAgICAgICAgY3JlZHM6IHN0YXRlLmNyZWRzLAogICAgICAgICAgICAgICAga2V5czogbWFrZUNhY2hlYWJsZVNpZ25hbEtleVN0b3JlKHN0YXRlLmtleXMsIHBpbm8oeyBsZXZlbDogImZhdGFsIiB9KS5jaGlsZCh7IGxldmVsOiAiZmF0YWwiIH0pKSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbWFya09ubGluZU9uQ29ubmVjdDogdHJ1ZSwKICAgICAgICAgICAgZ2VuZXJhdGVIaWdoUXVhbGl0eUxpbmtQcmV2aWV3OiB0cnVlLAogICAgICAgICAgICBzeW5jRnVsbEhpc3Rvcnk6IGZhbHNlLAogICAgICAgICAgICBnZXRNZXNzYWdlOiBhc3luYyAoa2V5KSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgamlkID0gamlkTm9ybWFsaXplZFVzZXIoa2V5LnJlbW90ZUppZCkKICAgICAgICAgICAgICAgIGxldCBtc2cgPSBhd2FpdCBzdG9yZS5sb2FkTWVzc2FnZShqaWQsIGtleS5pZCkKICAgICAgICAgICAgICAgIHJldHVybiBtc2c/Lm1lc3NhZ2UgfHwgIiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbXNnUmV0cnlDb3VudGVyQ2FjaGUsCiAgICAgICAgICAgIGRlZmF1bHRRdWVyeVRpbWVvdXRNczogNjAwMDAsCiAgICAgICAgICAgIGNvbm5lY3RUaW1lb3V0TXM6IDYwMDAwLAogICAgICAgICAgICBrZWVwQWxpdmVJbnRlcnZhbE1zOiAxMDAwMCwKICAgICAgICB9KQoKICAgICAgICAvLyBTYXZlIGNyZWRlbnRpYWxzIHdoZW4gdGhleSB1cGRhdGUKICAgICAgICBYZW9uQm90SW5jLmV2Lm9uKCdjcmVkcy51cGRhdGUnLCBzYXZlQ3JlZHMpCgogICAgc3RvcmUuYmluZChYZW9uQm90SW5jLmV2KQoKICAgIC8vIE1lc3NhZ2UgaGFuZGxpbmcKICAgIFhlb25Cb3RJbmMuZXYub24oJ21lc3NhZ2VzLnVwc2VydCcsIGFzeW5jIGNoYXRVcGRhdGUgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IG1layA9IGNoYXRVcGRhdGUubWVzc2FnZXNbMF0KICAgICAgICAgICAgaWYgKCFtZWsubWVzc2FnZSkgcmV0dXJuCgogICAgICAgICAgICAvLyBUcmFjayB1c2VyIGZvciBicm9hZGNhc3QgKEFERCBUSElTIEJMT0NLKQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgdXNlcklkID0gbWVrLmtleT8ucmVtb3RlSmlkOwogICAgICAgICAgICAgICAgaWYgKHVzZXJJZCAmJiAhdXNlcklkPy5pbmNsdWRlcygnQGcudXMnKSkgeyAvLyBPbmx5IHRyYWNrIGluZGl2aWR1YWwgdXNlcnMsIG5vdCBncm91cHMKICAgICAgICAgICAgICAgICAgICAvLyBJbXBvcnQgYmNDb21tYW5kCiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmNDb21tYW5kID0gcmVxdWlyZSgnLi9jb21tYW5kcy9iYycpOwogICAgICAgICAgICAgICAgICAgIGJjQ29tbWFuZC5hZGRDb25uZWN0ZWRVc2VyKHVzZXJJZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB0cmFja2luZyB1c2VyIGluIGluZGV4LmpzOicsIGVycm9yKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWVrLm1lc3NhZ2UgPSAoT2JqZWN0LmtleXMobWVrLm1lc3NhZ2UpWzBdID09PSAnZXBoZW1lcmFsTWVzc2FnZScpID8gbWVrLm1lc3NhZ2UuZXBoZW1lcmFsTWVzc2FnZS5tZXNzYWdlIDogbWVrLm1lc3NhZ2UKICAgICAgICAgICAgaWYgKG1lay5rZXkgJiYgbWVrLmtleS5yZW1vdGVKaWQgPT09ICdzdGF0dXNAYnJvYWRjYXN0JykgewogICAgICAgICAgICAgICAgYXdhaXQgaGFuZGxlU3RhdHVzKFhlb25Cb3RJbmMsIGNoYXRVcGRhdGUpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIEluIHByaXZhdGUgbW9kZSwgb25seSBibG9jayBub24tZ3JvdXAgbWVzc2FnZXMgKGFsbG93IGdyb3VwcyBmb3IgbW9kZXJhdGlvbikKICAgICAgICAgICAgLy8gTm90ZTogWGVvbkJvdEluYy5wdWJsaWMgaXMgbm90IHN5bmNlZCwgc28gd2UgY2hlY2sgbW9kZSBpbiBtYWluLmpzIGluc3RlYWQKICAgICAgICAgICAgLy8gVGhpcyBjaGVjayBpcyBrZXB0IGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IGJ1dCBtYWlubHkgYmxvY2tzIERNcwogICAgICAgICAgICBpZiAoIVhlb25Cb3RJbmMucHVibGljICYmICFtZWsua2V5LmZyb21NZSAmJiBjaGF0VXBkYXRlLnR5cGUgPT09ICdub3RpZnknKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpc0dyb3VwID0gbWVrLmtleT8ucmVtb3RlSmlkPy5lbmRzV2l0aCgnQGcudXMnKQogICAgICAgICAgICAgICAgaWYgKCFpc0dyb3VwKSByZXR1cm4gLy8gQmxvY2sgRE1zIGluIHByaXZhdGUgbW9kZSwgYnV0IGFsbG93IGdyb3VwIG1lc3NhZ2VzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1lay5rZXkuaWQuc3RhcnRzV2l0aCgnQkFFNScpICYmIG1lay5rZXkuaWQubGVuZ3RoID09PSAxNikgcmV0dXJuCgogICAgICAgICAgICAvLyBDbGVhciBtZXNzYWdlIHJldHJ5IGNhY2hlIHRvIHByZXZlbnQgbWVtb3J5IGJsb2F0CiAgICAgICAgICAgIGlmIChYZW9uQm90SW5jPy5tc2dSZXRyeUNvdW50ZXJDYWNoZSkgewogICAgICAgICAgICAgICAgWGVvbkJvdEluYy5tc2dSZXRyeUNvdW50ZXJDYWNoZS5jbGVhcigpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCBoYW5kbGVNZXNzYWdlcyhYZW9uQm90SW5jLCBjaGF0VXBkYXRlLCB0cnVlKQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGluIGhhbmRsZU1lc3NhZ2VzOiIsIGVycikKICAgICAgICAgICAgICAgIC8vIE9ubHkgdHJ5IHRvIHNlbmQgZXJyb3IgbWVzc2FnZSBpZiB3ZSBoYXZlIGEgdmFsaWQgY2hhdElkCiAgICAgICAgICAgICAgICBpZiAobWVrLmtleSAmJiBtZWsua2V5LnJlbW90ZUppZCkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IFhlb25Cb3RJbmMuc2VuZE1lc3NhZ2UobWVrLmtleS5yZW1vdGVKaWQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ+KdjCBBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBwcm9jZXNzaW5nIHlvdXIgbWVzc2FnZS4nCiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goY29uc29sZS5lcnJvcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgaW4gbWVzc2FnZXMudXBzZXJ0OiIsIGVycikKICAgICAgICB9CiAgICB9KQoKICAgIC8vIEFkZCB0aGVzZSBldmVudCBoYW5kbGVycyBmb3IgYmV0dGVyIGZ1bmN0aW9uYWxpdHkKICAgIFhlb25Cb3RJbmMuZGVjb2RlSmlkID0gKGppZCkgPT4gewogICAgICAgIGlmICghamlkKSByZXR1cm4gamlkCiAgICAgICAgaWYgKC86XGQrQC9naS50ZXN0KGppZCkpIHsKICAgICAgICAgICAgbGV0IGRlY29kZSA9IGppZERlY29kZShqaWQpIHx8IHt9CiAgICAgICAgICAgIHJldHVybiBkZWNvZGUudXNlciAmJiBkZWNvZGUuc2VydmVyICYmIGRlY29kZS51c2VyICsgJ0AnICsgZGVjb2RlLnNlcnZlciB8fCBqaWQKICAgICAgICB9IGVsc2UgcmV0dXJuIGppZAogICAgfQoKICAgIFhlb25Cb3RJbmMuZXYub24oJ2NvbnRhY3RzLnVwZGF0ZScsIHVwZGF0ZSA9PiB7CiAgICAgICAgZm9yIChsZXQgY29udGFjdCBvZiB1cGRhdGUpIHsKICAgICAgICAgICAgbGV0IGlkID0gWGVvbkJvdEluYy5kZWNvZGVKaWQoY29udGFjdC5pZCkKICAgICAgICAgICAgaWYgKHN0b3JlICYmIHN0b3JlLmNvbnRhY3RzKSBzdG9yZS5jb250YWN0c1tpZF0gPSB7IGlkLCBuYW1lOiBjb250YWN0Lm5vdGlmeSB9CiAgICAgICAgfQogICAgfSkKCiAgICBYZW9uQm90SW5jLmdldE5hbWUgPSAoamlkLCB3aXRob3V0Q29udGFjdCA9IGZhbHNlKSA9PiB7CiAgICAgICAgaWQgPSBYZW9uQm90SW5jLmRlY29kZUppZChqaWQpCiAgICAgICAgd2l0aG91dENvbnRhY3QgPSBYZW9uQm90SW5jLndpdGhvdXRDb250YWN0IHx8IHdpdGhvdXRDb250YWN0CiAgICAgICAgbGV0IHYKICAgICAgICBpZiAoaWQuZW5kc1dpdGgoIkBnLnVzIikpIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSkgPT4gewogICAgICAgICAgICB2ID0gc3RvcmUuY29udGFjdHNbaWRdIHx8IHt9CiAgICAgICAgICAgIGlmICghKHYubmFtZSB8fCB2LnN1YmplY3QpKSB2ID0gWGVvbkJvdEluYy5ncm91cE1ldGFkYXRhKGlkKSB8fCB7fQogICAgICAgICAgICByZXNvbHZlKHYubmFtZSB8fCB2LnN1YmplY3QgfHwgUGhvbmVOdW1iZXIoJysnICsgaWQucmVwbGFjZSgnQHMud2hhdHNhcHAubmV0JywgJycpKS5nZXROdW1iZXIoJ2ludGVybmF0aW9uYWwnKSkKICAgICAgICB9KQogICAgICAgIGVsc2UgdiA9IGlkID09PSAnMEBzLndoYXRzYXBwLm5ldCcgPyB7CiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBuYW1lOiAnV2hhdHNBcHAnCiAgICAgICAgfSA6IGlkID09PSBYZW9uQm90SW5jLmRlY29kZUppZChYZW9uQm90SW5jLnVzZXIuaWQpID8KICAgICAgICAgICAgWGVvbkJvdEluYy51c2VyIDoKICAgICAgICAgICAgKHN0b3JlLmNvbnRhY3RzW2lkXSB8fCB7fSkKICAgICAgICByZXR1cm4gKHdpdGhvdXRDb250YWN0ID8gJycgOiB2Lm5hbWUpIHx8IHYuc3ViamVjdCB8fCB2LnZlcmlmaWVkTmFtZSB8fCBQaG9uZU51bWJlcignKycgKyBqaWQucmVwbGFjZSgnQHMud2hhdHNhcHAubmV0JywgJycpKS5nZXROdW1iZXIoJ2ludGVybmF0aW9uYWwnKQogICAgfQoKICAgIFhlb25Cb3RJbmMucHVibGljID0gdHJ1ZQoKICAgIFhlb25Cb3RJbmMuc2VyaWFsaXplTSA9IChtKSA9PiBzbXNnKFhlb25Cb3RJbmMsIG0sIHN0b3JlKQoKICAgIC8vIEhhbmRsZSBwYWlyaW5nIGNvZGUKICAgIGlmIChwYWlyaW5nQ29kZSAmJiAhWGVvbkJvdEluYy5hdXRoU3RhdGUuY3JlZHMucmVnaXN0ZXJlZCkgewogICAgICAgIGlmICh1c2VNb2JpbGUpIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHVzZSBwYWlyaW5nIGNvZGUgd2l0aCBtb2JpbGUgYXBpJykKCiAgICAgICAgbGV0IHBob25lTnVtYmVyCiAgICAgICAgaWYgKCEhZ2xvYmFsLnBob25lTnVtYmVyKSB7CiAgICAgICAgICAgIHBob25lTnVtYmVyID0gZ2xvYmFsLnBob25lTnVtYmVyCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcGhvbmVOdW1iZXIgPSBhd2FpdCBxdWVzdGlvbihjaGFsay5iZ0JsYWNrKGNoYWxrLmdyZWVuQnJpZ2h0KGBQbGVhc2UgdHlwZSB5b3VyIFdoYXRzQXBwIG51bWJlciDwn5iNXG5Gb3JtYXQ6IDI2MzAzMDYyNjA0OCAod2l0aG91dCArIG9yIHNwYWNlcykgOiBgKSkpCiAgICAgICAgfQoKICAgICAgICAvLyBDbGVhbiB0aGUgcGhvbmUgbnVtYmVyIC0gcmVtb3ZlIGFueSBub24tZGlnaXQgY2hhcmFjdGVycwogICAgICAgIHBob25lTnVtYmVyID0gcGhvbmVOdW1iZXIucmVwbGFjZSgvW14wLTldL2csICcnKQoKICAgICAgICAvLyBWYWxpZGF0ZSB0aGUgcGhvbmUgbnVtYmVyIHVzaW5nIGF3ZXNvbWUtcGhvbmVudW1iZXIKICAgICAgICBjb25zdCBwbiA9IHJlcXVpcmUoJ2F3ZXNvbWUtcGhvbmVudW1iZXInKTsKICAgICAgICBpZiAoIXBuKCcrJyArIHBob25lTnVtYmVyKS5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coY2hhbGsucmVkKCdJbnZhbGlkIHBob25lIG51bWJlci4gUGxlYXNlIGVudGVyIHlvdXIgZnVsbCBpbnRlcm5hdGlvbmFsIG51bWJlciAoZS5nLiwgMTU1NTEyMzQ1NjcgZm9yIFVTLCA0NDc5MTExMjM0NTYgZm9yIFVLLCBldGMuKSB3aXRob3V0ICsgb3Igc3BhY2VzLicpKTsKICAgICAgICAgICAgcHJvY2Vzcy5leGl0KDEpOwogICAgICAgIH0KCiAgICAgICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsZXQgY29kZSA9IGF3YWl0IFhlb25Cb3RJbmMucmVxdWVzdFBhaXJpbmdDb2RlKHBob25lTnVtYmVyKQogICAgICAgICAgICAgICAgY29kZSA9IGNvZGU/Lm1hdGNoKC8uezEsNH0vZyk/LmpvaW4oIi0iKSB8fCBjb2RlCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5ibGFjayhjaGFsay5iZ0dyZWVuKGBZb3VyIFBhaXJpbmcgQ29kZSA6IGApKSwgY2hhbGsuYmxhY2soY2hhbGsud2hpdGUoY29kZSkpKQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coY2hhbGsueWVsbG93KGBcblBsZWFzZSBlbnRlciB0aGlzIGNvZGUgaW4geW91ciBXaGF0c0FwcCBhcHA6XG4xLiBPcGVuIFdoYXRzQXBwXG4yLiBHbyB0byBTZXR0aW5ncyA+IExpbmtlZCBEZXZpY2VzXG4zLiBUYXAgIkxpbmsgYSBEZXZpY2UiXG40LiBFbnRlciB0aGUgY29kZSBzaG93biBhYm92ZWApKQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVxdWVzdGluZyBwYWlyaW5nIGNvZGU6JywgZXJyb3IpCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5yZWQoJ0ZhaWxlZCB0byBnZXQgcGFpcmluZyBjb2RlLiBQbGVhc2UgY2hlY2sgeW91ciBwaG9uZSBudW1iZXIgYW5kIHRyeSBhZ2Fpbi4nKSkKICAgICAgICAgICAgfQogICAgICAgIH0sIDMwMDApCiAgICB9CgogICAgLy8gQ29ubmVjdGlvbiBoYW5kbGluZwogICAgWGVvbkJvdEluYy5ldi5vbignY29ubmVjdGlvbi51cGRhdGUnLCBhc3luYyAocykgPT4gewogICAgICAgIGNvbnN0IHsgY29ubmVjdGlvbiwgbGFzdERpc2Nvbm5lY3QsIHFyIH0gPSBzCgogICAgICAgIGlmIChxcikgewogICAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay55ZWxsb3coJ/Cfk7EgUVIgQ29kZSBnZW5lcmF0ZWQuIFBsZWFzZSBzY2FuIHdpdGggV2hhdHNBcHAuJykpCiAgICAgICAgfQoKICAgICAgICBpZiAoY29ubmVjdGlvbiA9PT0gJ2Nvbm5lY3RpbmcnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGNoYWxrLnllbGxvdygn8J+UhCBDb25uZWN0aW5nIHRvIFdoYXRzQXBwLi4uJykpCiAgICAgICAgfQoKICAgICAgICBpZiAoY29ubmVjdGlvbiA9PSAib3BlbiIpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coY2hhbGsubWFnZW50YShgIGApKQogICAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay55ZWxsb3coYPCfjL9Db25uZWN0ZWQgdG8gPT4gYCArIEpTT04uc3RyaW5naWZ5KFhlb25Cb3RJbmMudXNlciwgbnVsbCwgMikpKQoKICAgICAgICAgICAgLy8gQVVUTy1KT0lOIENPTU1VTklUWSBGRUFUVVJFCiAgICAgICAgICAgIGF3YWl0IGF1dG9Kb2luQ29tbXVuaXR5KFhlb25Cb3RJbmMpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGJvdE51bWJlciA9IFhlb25Cb3RJbmMudXNlci5pZC5zcGxpdCgnOicpWzBdICsgJ0BzLndoYXRzYXBwLm5ldCc7CiAgICAgICAgICAgICAgICBhd2FpdCBYZW9uQm90SW5jLnNlbmRNZXNzYWdlKGJvdE51bWJlciwgewogICAgICAgICAgICAgICAgICAgIHRleHQ6IGBCb3QgaXMgYWN0aXZlICFgCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNlbmRpbmcgY29ubmVjdGlvbiBtZXNzYWdlOicsIGVycm9yLm1lc3NhZ2UpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGF3YWl0IGRlbGF5KDE5OTkpCiAgICAgICAgICAgIGNvbnNvbGUubG9nKGNoYWxrLnllbGxvdyhgXG5cbiAgICAgICAgICAgICAgICAgICR7Y2hhbGsuYm9sZC5ibHVlKGBbICR7Z2xvYmFsLmJvdG5hbWUgfHwgJ1RLVC1DWUJFUi1YTUQnfSBdYCl9XG5cbmApKQogICAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5jeWFuKGA8ID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ID5gKSkKICAgICAgICAgICAgY29uc29sZS5sb2coY2hhbGsubWFnZW50YShgXG4ke2dsb2JhbC50aGVtZWVtb2ppIHx8ICfigKInfSBZVCBDSEFOTkVMOiB0YWZhZHp3YXRrdGApKQogICAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5tYWdlbnRhKGAke2dsb2JhbC50aGVtZWVtb2ppIHx8ICfigKInfSBHSVRIVUI6IHRrdHRlY2hgKSkKICAgICAgICAgICAgY29uc29sZS5sb2coY2hhbGsubWFnZW50YShgJHtnbG9iYWwudGhlbWVlbW9qaSB8fCAn4oCiJ30gV0EgTlVNQkVSOiAke293bmVyfWApKQogICAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5tYWdlbnRhKGAke2dsb2JhbC50aGVtZWVtb2ppIHx8ICfigKInfSBDUkVESVQ6IFRLVC1DWUJFUi1CT1RaIFRFQ0hgKSkKICAgICAgICAgICAgY29uc29sZS5sb2coY2hhbGsuZ3JlZW4oYCR7Z2xvYmFsLnRoZW1lZW1vamkgfHwgJ+KAoid9IPCfpJYgQm90IENvbm5lY3RlZCBTdWNjZXNzZnVsbHkhIOKchWApKQogICAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5ibHVlKGBCb3QgVmVyc2lvbjogJHtzZXR0aW5ncy52ZXJzaW9ufWApKQogICAgICAgICAgICBjb25zb2xlLmxvZyhjaGFsay5jeWFuKGBBdXRvLWpvaW46IEVuYWJsZWRgKSkKICAgICAgICB9CgogICAgICAgIGlmIChjb25uZWN0aW9uID09PSAnY2xvc2UnKSB7CiAgICAgICAgICAgIGNvbnN0IHNob3VsZFJlY29ubmVjdCA9IChsYXN0RGlzY29ubmVjdD8uZXJyb3IpPy5vdXRwdXQ/LnN0YXR1c0NvZGUgIT09IERpc2Nvbm5lY3RSZWFzb24ubG9nZ2VkT3V0CiAgICAgICAgICAgIGNvbnN0IHN0YXR1c0NvZGUgPSBsYXN0RGlzY29ubmVjdD8uZXJyb3I/Lm91dHB1dD8uc3RhdHVzQ29kZQoKICAgICAgICAgICAgY29uc29sZS5sb2coY2hhbGsucmVkKGBDb25uZWN0aW9uIGNsb3NlZCBkdWUgdG8gJHtsYXN0RGlzY29ubmVjdD8uZXJyb3J9LCByZWNvbm5lY3RpbmcgJHtzaG91bGRSZWNvbm5lY3R9YCkpCgogICAgICAgICAgICBpZiAoc3RhdHVzQ29kZSA9PT0gRGlzY29ubmVjdFJlYXNvbi5sb2dnZWRPdXQgfHwgc3RhdHVzQ29kZSA9PT0gNDAxKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJtU3luYygnLi9zZXNzaW9uJywgeyByZWN1cnNpdmU6IHRydWUsIGZvcmNlOiB0cnVlIH0pCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coY2hhbGsueWVsbG93KCdTZXNzaW9uIGZvbGRlciBkZWxldGVkLiBQbGVhc2UgcmUtYXV0aGVudGljYXRlLicpKQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBzZXNzaW9uOicsIGVycm9yKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coY2hhbGsucmVkKCdTZXNzaW9uIGxvZ2dlZCBvdXQuIFBsZWFzZSByZS1hdXRoZW50aWNhdGUuJykpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzaG91bGRSZWNvbm5lY3QpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNoYWxrLnllbGxvdygnUmVjb25uZWN0aW5nLi4uJykpCiAgICAgICAgICAgICAgICBhd2FpdCBkZWxheSg1MDAwKQogICAgICAgICAgICAgICAgc3RhcnRYZW9uQm90SW5jKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pCgogICAgLy8gU0lNUExJRklFRCBBTlRJQ0FMTCBIQU5ETEVSIC0gT25seSByZWplY3RzIGNhbGxzLCBubyBtZXNzYWdlcywgbm8gYmxvY2tpbmcKICAgIFhlb25Cb3RJbmMuZXYub24oJ2NhbGwnLCBhc3luYyAoY2FsbHMpID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCB7IHJlYWRTdGF0ZTogcmVhZEFudGljYWxsU3RhdGUgfSA9IHJlcXVpcmUoJy4vY29tbWFuZHMvYW50aWNhbGwnKTsKICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSByZWFkQW50aWNhbGxTdGF0ZSgpOwogICAgICAgICAgICBpZiAoIXN0YXRlLmVuYWJsZWQpIHJldHVybjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAoY29uc3QgY2FsbCBvZiBjYWxscykgewogICAgICAgICAgICAgICAgY29uc3QgY2FsbGVySmlkID0gY2FsbC5mcm9tIHx8IGNhbGwucGVlckppZCB8fCBjYWxsLmNoYXRJZDsKICAgICAgICAgICAgICAgIGlmICghY2FsbGVySmlkKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAvLyBTaWxlbnRseSByZWplY3QgdGhlIGNhbGwgd2l0aG91dCBzZW5kaW5nIGFueSBtZXNzYWdlcwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgWGVvbkJvdEluYy5yZWplY3RDYWxsID09PSAnZnVuY3Rpb24nICYmIGNhbGwuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgWGVvbkJvdEluYy5yZWplY3RDYWxsKGNhbGwuaWQsIGNhbGxlckppZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgWGVvbkJvdEluYy5zZW5kQ2FsbE9mZmVyQWNrID09PSAnZnVuY3Rpb24nICYmIGNhbGwuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgWGVvbkJvdEluYy5zZW5kQ2FsbE9mZmVyQWNrKGNhbGwuaWQsIGNhbGxlckppZCwgJ3JlamVjdCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2lsZW50bHkgaWdub3JlIGFueSBlcnJvcnMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIC8vIFNpbGVudGx5IGlnbm9yZSBhbnkgZXJyb3JzCiAgICAgICAgfQogICAgfSk7CgogICAgWGVvbkJvdEluYy5ldi5vbignZ3JvdXAtcGFydGljaXBhbnRzLnVwZGF0ZScsIGFzeW5jICh1cGRhdGUpID0+IHsKICAgICAgICBhd2FpdCBoYW5kbGVHcm91cFBhcnRpY2lwYW50VXBkYXRlKFhlb25Cb3RJbmMsIHVwZGF0ZSk7CiAgICB9KTsKCiAgICBYZW9uQm90SW5jLmV2Lm9uKCdtZXNzYWdlcy51cHNlcnQnLCBhc3luYyAobSkgPT4gewogICAgICAgIGlmIChtLm1lc3NhZ2VzWzBdLmtleSAmJiBtLm1lc3NhZ2VzWzBdLmtleS5yZW1vdGVKaWQgPT09ICdzdGF0dXNAYnJvYWRjYXN0JykgewogICAgICAgICAgICBhd2FpdCBoYW5kbGVTdGF0dXMoWGVvbkJvdEluYywgbSk7CiAgICAgICAgfQogICAgfSk7CgogICAgWGVvbkJvdEluYy5ldi5vbignc3RhdHVzLnVwZGF0ZScsIGFzeW5jIChzdGF0dXMpID0+IHsKICAgICAgICBhd2FpdCBoYW5kbGVTdGF0dXMoWGVvbkJvdEluYywgc3RhdHVzKTsKICAgIH0pOwoKICAgIFhlb25Cb3RJbmMuZXYub24oJ21lc3NhZ2VzLnJlYWN0aW9uJywgYXN5bmMgKHN0YXR1cykgPT4gewogICAgICAgIGF3YWl0IGhhbmRsZVN0YXR1cyhYZW9uQm90SW5jLCBzdGF0dXMpOwogICAgfSk7CgogICAgcmV0dXJuIFhlb25Cb3RJbmMKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gc3RhcnRYZW9uQm90SW5jOicsIGVycm9yKQogICAgICAgIGF3YWl0IGRlbGF5KDUwMDApCiAgICAgICAgc3RhcnRYZW9uQm90SW5jKCkKICAgIH0KfQoKCi8vIFN0YXJ0IHRoZSBib3Qgd2l0aCBlcnJvciBoYW5kbGluZwpzdGFydFhlb25Cb3RJbmMoKS5jYXRjaChlcnJvciA9PiB7CiAgICBjb25zb2xlLmVycm9yKCdGYXRhbCBlcnJvcjonLCBlcnJvcikKICAgIHByb2Nlc3MuZXhpdCgxKQp9KQpwcm9jZXNzLm9uKCd1bmNhdWdodEV4Y2VwdGlvbicsIChlcnIpID0+IHsKICAgIGNvbnNvbGUuZXJyb3IoJ1VuY2F1Z2h0IEV4Y2VwdGlvbjonLCBlcnIpCn0pCgpwcm9jZXNzLm9uKCd1bmhhbmRsZWRSZWplY3Rpb24nLCAoZXJyKSA9PiB7CiAgICBjb25zb2xlLmVycm9yKCdVbmhhbmRsZWQgUmVqZWN0aW9uOicsIGVycikKfSkKCmxldCBmaWxlID0gcmVxdWlyZS5yZXNvbHZlKF9fZmlsZW5hbWUpCmZzLndhdGNoRmlsZShmaWxlLCAoKSA9PiB7CiAgICBmcy51bndhdGNoRmlsZShmaWxlKQogICAgY29uc29sZS5sb2coY2hhbGsucmVkQnJpZ2h0KGBVcGRhdGUgJHtfX2ZpbGVuYW1lfWApKQogICAgZGVsZXRlIHJlcXVpcmUuY2FjaGVbZmlsZV0KICAgIHJlcXVpcmUoZmlsZSkKfSk=
